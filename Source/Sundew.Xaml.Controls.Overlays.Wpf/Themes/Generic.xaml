<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:Sundew.Xaml.Controls.Overlays"
    xmlns:sx="http://sundew.dev/xaml">

    <local:AvoidNaNConverter x:Key="AvoidNaNConverter"/>
    <local:StringNotNullOrEmptyToVisibilityConverter x:Key="StringNotNullOrEmptyToVisibilityConverter"/>

    <RadialGradientBrush x:Key="RevealBrush" RadiusX="50" RadiusY="50" >
        <GradientStop Color="Transparent" Offset="0"/>
        <GradientStop Color="Transparent" Offset="0.96"/>
        <GradientStop Color="Black" Offset="1"/>
    </RadialGradientBrush>

    <Style TargetType="{x:Type local:SubtitleOverlay}">
        <Setter Property="Background" Value="#990C0A0A"/>
        <Setter Property="Foreground" Value="White"/>
        <Setter Property="Padding" Value="16,8"/>
        <Setter Property="FontSize" Value="32"/>
        <Setter Property="FontWeight" Value="Bold"/>
        <Setter Property="CornerRadius" Value="8"/>
        <Setter Property="MaxWidth" Value="{Binding RelativeSource={RelativeSource Mode=Self}, Path=MonitorWidth}"/>
        <Setter Property="MaxHeight" Value="{Binding RelativeSource={RelativeSource Mode=Self}, Path=MonitorHeight}"/>
        <Setter Property="RevealBrush" Value="{StaticResource RevealBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:SubtitleOverlay}">
                    <ControlTemplate.Resources>
                        <Storyboard x:Key="AnimateSizeStoryboard" TargetName="PART_Border">
                            <DoubleAnimation Storyboard.TargetProperty="Width"
                                             From="{Binding ElementName=PART_Border, Path=Width, Converter={StaticResource AvoidNaNConverter}}"
                                             To="{Binding ElementName=MeasureBorder, Path=ActualWidth, Converter={StaticResource AvoidNaNConverter}}"
                                             Duration="0:0:0.200">
                                <DoubleAnimation.EasingFunction>
                                    <QuadraticEase EasingMode="EaseOut"/>
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                            <DoubleAnimation Storyboard.TargetProperty="Height"
                                             From="{Binding ElementName=PART_Border, Path=Height, Converter={StaticResource AvoidNaNConverter}}"
                                             To="{Binding ElementName=MeasureBorder, Path=ActualHeight, Converter={StaticResource AvoidNaNConverter}}"
                                             Duration="0:0:0.200">
                                <DoubleAnimation.EasingFunction>
                                    <QuadraticEase EasingMode="EaseOut"/>
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </ControlTemplate.Resources>
                    <Grid Visibility="{TemplateBinding Subtitle, Converter={StaticResource StringNotNullOrEmptyToVisibilityConverter}}">
                        <sx:Border x:Name="MeasureBorder"
                               HorizontalAlignment="Center" VerticalAlignment="Bottom" Grid.Row="0"
                               CornerRadius="{TemplateBinding CornerRadius}"
                               Padding="{TemplateBinding Padding}"
                               Visibility="Hidden"
                               MaxWidth="{TemplateBinding MaxWidth}"
                               MaxHeight="{TemplateBinding MaxHeight}">
                            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center"
                                      Text="{TemplateBinding Subtitle}"
                                      Foreground="{TemplateBinding Foreground}" 
                                      FontSize="{TemplateBinding FontSize}"
                                      FontWeight="{TemplateBinding FontWeight}"
                                      TextWrapping="Wrap"
                                      TextAlignment="Center">
                            </TextBlock>
                        </sx:Border>
                        <sx:Border x:Name="PART_Border"
                                   Background="{TemplateBinding Background}"
                                   HorizontalAlignment="Center" VerticalAlignment="Bottom" Grid.Row="0"
                                   CornerRadius="{TemplateBinding CornerRadius}"
                                   Padding="{TemplateBinding Padding}"
                                   MaxWidth="{TemplateBinding MaxWidth}"
                                   MaxHeight="{TemplateBinding MaxHeight}">
                            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Text="{TemplateBinding Subtitle}"
                                       Foreground="{TemplateBinding Foreground}" 
                                       FontSize="{TemplateBinding FontSize}"
                                       FontWeight="{TemplateBinding FontWeight}"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center">
                                <TextBlock.Effect>
                                    <DropShadowEffect BlurRadius="3" ShadowDepth="1" Color="Black" Opacity="0.8"/>
                                </TextBlock.Effect>
                            </TextBlock>
                            <sx:Border.Effect>
                                <DropShadowEffect BlurRadius="15" ShadowDepth="3" Color="Black" Opacity="0.4"/>
                            </sx:Border.Effect>
                        </sx:Border>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="0.04*"/>
                        </Grid.RowDefinitions>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
